name: Build ScreenRecorder (manual git clone)

on:
  workflow_dispatch:   # run only when manually triggered

jobs:
  build:
    runs-on: windows-latest

    steps:
    # Clone the external repo using git
    - name: Clone ScreenRecorder repo
      run: git clone https://github.com/akon47/ScreenRecorder.git

    # Setup MSBuild (Visual Studio 2022)
    - name: Setup MSBuild
      uses: microsoft/setup-msbuild@v1.3

    # Setup NuGet
    - name: Setup NuGet
      uses: NuGet/setup-nuget@v1.2.0

    # Restore NuGet packages
    - name: Restore NuGet packages
      run: nuget restore ScreenRecorder/ScreenRecorder.sln

    # Install FFmpeg
    - name: Install FFmpeg
      run: choco install ffmpeg --yes

    # Build the solution (Release|x64 is valid per .sln file)
    - name: Build solution
      run: msbuild ScreenRecorder/ScreenRecorder.sln /p:Configuration=Release /p:Platform="x64"

    # Upload build artifacts
    - name: Upload build artifacts
      uses: actions/upload-artifact@v4
      with:
        name: ScreenRecorder-Release-x64
        path: |
          ScreenRecorder/**/bin/Release/
