name: Build-Ubuntu24-RootFS

on:
  workflow_dispatch:

jobs:
  build-rootfs:
    runs-on: ubuntu-latest

    steps:
      - name: Install dependencies
        run: |
          sudo apt update -y
          sudo apt install -y debootstrap squashfs-tools

      - name: Bootstrap Ubuntu 24.04 rootfs (with glibc)
        run: |
          sudo debootstrap --arch=amd64 --variant=buildd noble rootfs http://archive.ubuntu.com/ubuntu/

      - name: Add essentials (bash, coreutils, apt, ncurses)
        run: |
          sudo chroot rootfs /bin/sh -c "apt-get update && apt-get install -y bash coreutils apt libtinfo6 libncurses6"

      - name: Clean rootfs to reduce size
        run: |
          sudo chroot rootfs apt-get clean
          sudo rm -rf rootfs/var/lib/apt/lists/*
          sudo rm -rf rootfs/usr/share/doc/*
          sudo rm -rf rootfs/usr/share/man/*
          sudo rm -rf rootfs/usr/share/info/*
          sudo rm -rf rootfs/tmp/*

      - name: Create squashfs image
        run: |
          mksquashfs rootfs Ubuntu24_Working.sqsh -comp xz -b 1M -noappend

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: Ubuntu24-Working-RootFS
          path: Ubuntu24_Working.sqsh
