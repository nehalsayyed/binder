name: Android Emulator Boot and Record (API 36)

on:
  workflow_dispatch:

jobs:
  emulator:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Set up JDK 17
        uses: actions/setup-java@v3
        with:
          distribution: 'temurin'   # Corrected: required input
          java-version: '17'

      - name: Install Android SDK
        run: |
          sudo apt-get update
          sudo apt-get install -y qemu-kvm
          yes | sdkmanager --install \
            "platform-tools" \
            "platforms;android-36" \
            "system-images;android-36;google_apis;x86_64" \
            "emulator"
          yes | sdkmanager --licenses

      - name: Create and Start Emulator
        run: |
          avdmanager create avd -n api36 -k "system-images;android-36;google_apis;x86_64" --device "pixel_5"
          nohup emulator -avd api36 -no-window -no-audio -no-snapshot &
          adb wait-for-device
          adb shell input keyevent 82

      - name: Record Emulator Boot Video
        run: |
          adb shell screenrecord /sdcard/boot_api36.mp4 &
          RECORD_PID=$!
          sleep 30   # record for 30 seconds
          kill $RECORD_PID
          adb pull /sdcard/boot_api36.mp4 boot_api36.mp4

      - name: Upload Video Artifact
        uses: actions/upload-artifact@v4
        with:
          name: emulator-boot-video-api36
          path: boot_api36.mp4
