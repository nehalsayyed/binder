name: Build-Ubuntu24-RootFS

on:
  workflow_dispatch:   # Run manually

jobs:
  build-rootfs:
    runs-on: ubuntu-latest   # x86_64 runner

    steps:
      - name: Install dependencies
        run: |
          sudo apt update -y
          sudo apt install -y debootstrap squashfs-tools

      - name: Bootstrap minimal Ubuntu 24.04 rootfs
        run: |
          sudo debootstrap --arch=amd64 --variant=minbase noble rootfs http://archive.ubuntu.com/ubuntu/

      - name: Add essentials (bash, coreutils, apt)
        run: |
          sudo chroot rootfs apt-get update
          sudo chroot rootfs apt-get install -y bash coreutils apt

      - name: Clean rootfs to reduce size
        run: |
          sudo chroot rootfs apt-get clean
          sudo rm -rf rootfs/var/lib/apt/lists/*
          sudo rm -rf rootfs/usr/share/doc/*
          sudo rm -rf rootfs/usr/share/man/*
          sudo rm -rf rootfs/usr/share/info/*
          sudo rm -rf rootfs/tmp/*

      - name: Create squashfs image
        run: |
          mksquashfs rootfs Ubuntu24_Minimal.sqsh -comp xz -b 1M -noappend

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: Ubuntu24-Minimal-RootFS
          path: Ubuntu24_Minimal.sqsh
