name: Build Renode on Ubuntu 24.04 ARM

on:
  workflow_dispatch:   # manual trigger

jobs:
  build:
    runs-on: ubuntu-24.04-arm   # ARM64 runner

    steps:
      - name: Install Git
        run: |
          sudo apt-get update
          sudo apt-get install -y git

      - name: Clone Renode manually
        run: |
          git clone https://github.com/renode/renode.git
          cd renode
          git submodule update --init --recursive

      - name: Setup .NET
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: '8.0.x'   # adjust if Renode requires different version

      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y \
            mono-complete \
            msbuild \
            cmake \
            ninja-build \
            python3 \
            python3-pip \
            libgtk-3-dev \
            libx11-dev \
            libxcomposite-dev \
            libxcursor-dev \
            libxdamage-dev \
            libxext-dev \
            libxfixes-dev \
            libxi-dev \
            libxrandr-dev \
            libxtst-dev \
            libnss3-dev \
            libasound2-dev

      - name: Build Renode
        run: |
          cd renode
          dotnet build -c Release

      - name: Upload build artifacts
        uses: actions/upload-artifact@v4
        with:
          name: renode-build
          path: renode/bin/Release
