name: Build Warpinator (manual git clone)

on:
  workflow_dispatch:   # run only when manually triggered

jobs:
  build:
    runs-on: windows-latest

    steps:
    # Clone the external repo using git
    - name: Clone Warpinator repo
      run: git clone https://github.com/slowscript/warpinator-windows.git

    # Setup MSBuild (Visual Studio 2022)
    - name: Setup MSBuild
      uses: microsoft/setup-msbuild@v1.3

    # Setup NuGet
    - name: Setup NuGet
      uses: NuGet/setup-nuget@v1.2.0

    # Restore NuGet packages
    - name: Restore NuGet packages
      run: nuget restore warpinator-windows/Warpinator.sln

    # Build the solution (Release|Any CPU is valid per .sln file)
    - name: Build solution
      run: msbuild warpinator-windows/Warpinator.sln /p:Configuration=Release /p:Platform="Any CPU"

    # Upload build artifacts
    - name: Upload build artifacts
      uses: actions/upload-artifact@v4
      with:
        name: Warpinator-Release
        path: |
          warpinator-windows/**/bin/Release/
