name: Build Solidity

on:
  workflow_dispatch:   # manual trigger

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # Clone Solidity repo with submodules
      - name: Clone Solidity
        run: |
          git clone --recursive https://github.com/argotorg/solidity.git
          cd solidity

      # Install dependencies (GCC 13, CMake, Make, etc.)
      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y software-properties-common
          sudo add-apt-repository -y ppa:ubuntu-toolchain-r/test
          sudo apt-get update
          sudo apt-get install -y g++-13 gcc-13 cmake make

      # Verify GCC version
      - name: Verify GCC version
        run: |
          g++-13 --version
          gcc-13 --version

      # Configure and build
      - name: Configure and Build
        run: |
          cd solidity
          mkdir -p build
          cd build
          cmake .. -DCMAKE_CXX_COMPILER=g++-13 -DCMAKE_C_COMPILER=gcc-13
          make -j$(nproc)

      # Run build script
      - name: Run build script
        run: |
          cd solidity
          ./scripts/build.sh
