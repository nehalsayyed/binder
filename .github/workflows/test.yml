name: Firefox Installation and Screenshot Test (Playwright)

on:
  # Allows you to run this workflow manually from the GitHub Actions tab
  workflow_dispatch:

jobs:
  test_and_screenshot:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout Repository Code
        uses: actions/checkout@v4

      # --- Step 1: Set up Node.js (Required for Playwright) ---
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          
      # --- Step 2: Install Playwright and Firefox Browser ---
      - name: Install Playwright
        # Playwright installs its required browser binaries (like Firefox) automatically
        run: |
          npm install playwright
          npx playwright install firefox
          
      # --- Step 3: Create and Run the Screenshot Script ---
      - name: Capture Firefox Screenshot (via Playwright)
        # We run a small inline Node.js script to ensure reliable screenshot capture.
        run: |
          # This script launches Firefox in headless mode (default for CI), 
          # navigates to Google, and saves a screenshot.
          echo '
            const playwright = require("playwright");
            
            (async () => {
              // 1. Launch Firefox
              const browser = await playwright.firefox.launch();
              const page = await browser.newPage();
              
              // 2. Navigate and set viewport
              await page.setViewportSize({ width: 1280, height: 960 });
              console.log("Navigating to https://www.google.com");
              await page.goto("https://www.google.com");
              
              // 3. Take the screenshot
              await page.screenshot({ path: "screenshot.png", fullPage: true });
              console.log("Screenshot successfully saved as screenshot.png");
              
              // 4. Close the browser
              await browser.close();
            })();
          ' > screenshot.js
          
          node screenshot.js
          
      - name: Check for Screenshot File
        # Confirm the file exists after the script runs
        run: ls -l screenshot.png
        
      - name: Upload Screenshot Artifact
        # Upload the captured image so you can view it in the workflow run summary
        uses: actions/upload-artifact@v4
        with:
          name: firefox-screenshot
          path: screenshot.png
          retention-days: 1
