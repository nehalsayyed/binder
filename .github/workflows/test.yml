name: Build Android NDK Sample & Upload APK

on:
  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

jobs:
  android-apk:
    # Fix 1: Corrected YAML structure for the job and runs-on property
    runs-on: ubuntu-latest
    
    steps:
    
    # --- Environment Setup (Crucial for Android/Gradle) ---

    - name: Set up Java Environment
      # Action to set up Java, required by Gradle.
      uses: actions/setup-java@v4
      with:
        distribution: 'temurin'
        java-version: '17' # Standard version for modern Android projects

    # --- Project Setup ---

    - name: Clone NDK Hello World Repository
      # Fix 2: Using the recommended checkout action to clone the specific repo
      uses: actions/checkout@v4
      with:
        repository: byronh/ndk-helloworld
        path: ndk-helloworld # The local directory where the project will be placed

    - name: Grant Execute Permission to gradlew
      # Gradle wrapper needs execute permission
      run: chmod +x ndk-helloworld/gradlew

    # --- Build Step ---

    - name: Build Debug APK
      # Runs the build command from inside the cloned directory
      run: |
        cd ndk-helloworld
        # Using 'assembleDebug' to generate the debug APK
        ./gradlew assembleDebug
        # The NDK toolchain will be downloaded by Gradle automatically as needed.

    # --- Artifact Upload ---

    - name: Upload Video Artifact # Renamed artifact name to be more descriptive
      uses: actions/upload-artifact@v4
      with:
        name: generated-debug-apk
        # Fix 3: Added the correct path where the APK is located after a successful build
        path: ndk-helloworld/app/build/outputs/apk/debug/app-debug.apk
        retention-days: 7
