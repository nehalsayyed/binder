name: Android Emulator Screenshot Capture

on:
  # Allows manual triggering of the workflow
  workflow_dispatch:

jobs:
  screenshot_emulator:
    # Use a large runner for better performance with emulation (optional, but recommended)
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository Code
        uses: actions/checkout@v4

      # --- Step 1: Set up Java ---
      # Android requires a specific JDK version (e.g., JDK 17)
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'
          
      # --- Step 2: Install and Launch Android Emulator (AVD) ---
      - name: Run Android Emulator and Capture Screenshot
        uses: reactivecircus/android-emulator-runner@v2
        with:
          # Define the virtual device properties
          api-level: 30       # Android 11 (a common, stable API level)
          target: default     # Use a standard Android image
          arch: x86_64        # Architecture optimized for GitHub runners
          profile: Nexus 5    # Specify the device model profile
          
          # Crucial step for performance: disable emulator animations
          disable-animations: true
          
          # The main script to run once the emulator is fully booted and ready.
          # This is the equivalent of opening the browser in the previous example.
          script: |
            echo "Emulator is booted. Taking screenshot now..."
            
            # ADB command to capture the screen directly to standard output (-p for PNG)
            # The 'exec-out' flag ensures the raw binary data is piped correctly to the file.
            adb exec-out screencap -p > emulator_screenshot.png
            
            echo "Screenshot saved as emulator_screenshot.png"
            
            # Optional: Simulate navigation to an app (uncomment if you have an Android project)
            # adb shell am start -a android.intent.action.VIEW -d "https://www.google.com"
            # sleep 5 # Give it time to load the page
            # adb exec-out screencap -p > google_screenshot.png

      # --- Step 3: Verify and Upload the Artifact ---
      - name: Check for Screenshot File
        run: ls -l emulator_screenshot.png
        
      - name: Upload Emulator Screenshot Artifact
        uses: actions/upload-artifact@v4
        with:
          name: android-emulator-screenshot
          path: emulator_screenshot.png
          retention-days: 1
