name: Build Android NDK Sample & Upload APK

on:
  workflow_dispatch:

jobs:
  android-apk:
    runs-on: ubuntu-latest
    
    steps:
    
    # 1. Set up the Java environment required by Gradle (Java 17 is standard for modern Android)
    - name: Set up Java Environment
      uses: actions/setup-java@v4
      with:
        distribution: 'temurin'
        java-version: '17'

    # 2. Clone the official, maintained Google NDK Samples repository
    - name: Clone Official NDK Samples Repository
      uses: actions/checkout@v4
      with:
        # Using Google's official NDK samples repository for reliability
        repository: android/ndk-samples
        path: ndk-samples 

    # 3. Grant Execute Permission to the Gradle wrapper inside the 'hello-jni' sample
    - name: Grant Execute Permission to gradlew
      # We'll build the classic "hello-jni" example
      run: chmod +x ndk-samples/hello-jni/gradlew

    # 4. Build the Debug APK using the modern sample
    - name: Build Debug APK
      run: |
        # Navigate into the specific sample directory
        cd ndk-samples/hello-jni
        # The Gradle wrapper will now reliably download a modern Gradle distribution
        ./gradlew assembleDebug

    # 5. Upload the generated APK artifact
    - name: Upload Generated APK Artifact
      uses: actions/upload-artifact@v4
      with:
        name: generated-debug-apk
        # Correct path for the APK inside the new project structure
        path: ndk-samples/hello-jni/app/build/outputs/apk/debug/app-debug.apk
        retention-days: 7
